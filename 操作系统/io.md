---
created_at: 2023-10-04
modified_at: 2023-10-04
description: 
aliases: 
tags:
  - 操作系统
---
## io模型
- 同步堵塞
- 同步非堵塞
- 异步
- io多路复用
- 信号驱动
## 设备分类
- 字符设备
- 块设备
- 网络设备

<!-- TODO
## io应用程序接口
-->
## io设备模型
- 控制器
- 状态寄存器
- 数据寄存器
- 指令寄存器
- io逻辑处理
- 工作机构
## io栈
![[../assets/img/20231004012308.png]]
- 用户层软件
	- 提供了与用户交互的接口，用户可以直接使用该层提供的库函数对I/O设备进行操作
	- 将用户的请求进行翻译，通过系统调用请求操作系统内核的服务
- 设备独立性软件（设备无关软件）
	- 向上层提供调用接口
	- 对设备的保护，与对文件的保护类似
	- 差错处理
	- 设备的分配与回收
	- 数据缓冲区管理
	- 建立逻辑设备名与物理设备名之间的映射关系，并选择调用相应的驱动程序
	- 通过逻辑设备表（LUT）实现
	- 可以整个系统一张LUT，也可以每个用户一张LUT（类似两级目录）
- 设备驱动程序
	- 将抽象要求转化为具体要求
	- 检查I/O请求的合法性
	- 了解I/O设备状态、传递相关参数、设置设备工作方式
	- 发出I/O操作命令，启动I/O设备
- 响应通道的中断请求
	- 构造通道程序
	- 中断处理程序
	- 当I/O任务完成时，I/O控制器会发出中断信号，系统会根据此信号找到相应的中断处理程序并执行
	
## io控制方式
- 轮询
- 中断
- dma
- 通道

## io调度策略
### 指标
- 公平
- 效率

### （机械硬盘）io调度策略
||公平|效率||
|--|--|--|--|
|FCFS先来先服务|O|X|对于一个磁道跨度大的工作负载表现差|
|SSTF最短寻道时间优先|X|O|对较远磁道的作业不公平|
|SCAN电梯调度|O|O|到达最边上的磁道才反向移动, 对刚扫描过的磁道不公平访问局部性不好，偏向于边上磁道的请求|
|LOOK调度|O|O|不用移动到最边上，缩短寻道时间，对刚扫描过的磁道不公平访问局部性不好，偏向于边上磁道的请求|
|CSCAN调度|O|O|解决了偏向于边上磁道的请求的问题|
|CLOOK调度|O|O|解决了偏向于边上磁道的请求的问题|

## 访问控制
## SPOOLing
![[../assets/img/20231004013004.png]]
## 设备的分配与回收
### 考虑因素
1. 固有属性
	- 独占设备
	- 共享设备
		 某个时间**段**共享
	- 虚拟设备
2. 调度策略
3. 安全性 死锁
### 分配方式
- 静态分配
- 动态分配
### 设备分配管理中的数据结构
- 设备控制表（DCT）：每个设备一张，用于记录设备情况
	- 设备类型
	- 设备标识符
	- 设备状态
	- 指向控制器表的指针：指明设备所属的控制器
	- 重复执行次数或时间：只有多少次I/O操作失败后才判断失败
	- 设备队列的队首指针：指向当前设备的等待进程队列（由PCB组成）
- 控制器控制表（COCT）：每个控制器一张，操作系统跟具COCT对控制器进行操作和管理
	- 控制器标识符
	- 控制器状态
	- 指向通道表的指针：指明控制器所属的通道
	- 控制器队列的队首指针：指向正在等待控制器的进程队列
	- 控制器队列的队尾指针
- 通道控制表（CHCT）：每个通道一张，操作系统根据CHCT对通道进行操作和管理
	- 通道标识符
	- 通道状态
	- 与通道连接的控制器表首址：可通过该指针找到该通道管理的所有控制器相关信息
	- 通道队列的队首指针
	- 通道队列的队尾指针
- 系统设备表（SDT）：记录了系统中全部设备的情况，每个设备对应一个表目
	- 每一个表目记录设备的相关信息
	- 设备类型
	- 设备标识符
	- DCT（设备控制表）
	- 驱动程序入口
#### 设备分配的步骤
1. 根据进程请求的物理设备名查找SDT
2. 根据SDT找到DCT
3. 若设备忙碌则将进程PCB挂到设备等待队列中
4. 不忙碌则将设备分配给进程
5. 根据DCT找到COCT
6. 若控制器忙碌则将进程PCB挂到控制器等待队列中
7. 不忙碌则将控制器分配给进程
8. 根据COCT找到CHCT
9. 若通道忙碌则将进程PCB挂到通道等待队列中
10. 不忙碌则将通道分配给进 程。
#### 缺点
用户必须使用物理设备名来请求设备，这导致了
若换了一个物理设备，则程序无法运行
若进程请求的物理设备正在忙碌，则即使系统中还有同类型的设备，进程也必须阻塞等待这特定的一个
#### 解决方式
建立逻辑设备名与物理设备名的映射表。
用户在请求设备时只需要提供逻辑设备名，系统会查找符合条件且空闲的设备分配给进程。
## 缓冲区
### 缓冲区的作用
- 缓和CPU与I/O设备之间速度不匹配的矛盾
- 减少对CPU的中断频率，放宽对CPU中断相应时间的限制
- 解决数据粒度不匹配的问题（输出进程每次输出一块，I/O每次只能输出一个字）
- 提高CPU与I/O设备之间的并行性
### 策略
从设备传入缓冲区的时间为$T$
从缓冲区传入到用户进程的工作区所用的时间为$M$
用户进程处理一块数据的时间为$C$
1. 单缓冲 $max(T,C) + M$
2. 双缓冲 $max(T,C+M)$
3. 循环缓冲
4. 缓冲池